FieldsManage=function(){this.Fields=[];this.setFields=function(a){this.Fields=a;};this.addField=function(b){var a=this.isFieldExist(b.fieldName);if(a){return;}this.Fields.push(b);};this.delField=function(c){for(var a=this.Fields.length-1;a>=0;a--){var b=this.Fields[a];if(b.fieldName.toLowerCase()==c.toLowerCase()){this.Fields.splice(a,1);}}};this.updField=function(d){for(var b=this.Fields.length-1;b>=0;b--){var a=this.Fields[b];if(a.fieldName.toLowerCase()==d.fieldName.toLowerCase()){var c=this.Fields[b];d=$.extend({},c,d);this.Fields[b]=d;}}};this.replaceByFieldName=function(c,e){for(var b=0;b<this.Fields.length;b++){var a=this.Fields[b];if(a.fieldName.toLowerCase()==c.toLowerCase()){var d=this.Fields[b];e=$.extend({},d,e);this.Fields[b]=e;}}};this.isFieldExist=function(b){for(var c=0;c<this.Fields.length;c++){var e=this.Fields[c];var f=e.fieldName.toLowerCase();b=b.toLowerCase();var d=this.isExecutorSelector(e.controlType);if(d){var a=f+"id";if(f==b||a==b){return true;}}else{if(f==b){return true;}}}return false;};this.isExecutorSelector=function(a){a=parseInt(a);if(a==4||a==8||a==17||a==5||a==18||a==6||a==19||a==7){return true;}return false;};this.moveField=function(f,e){var a=this.getFieldIndex(f);if(a==-1){return false;}var c=0;var d=false;if(e){if(a>0){c=a-1;d=true;}}else{if(a<this.Fields.length-1){c=a+1;d=true;}}if(d){var b=this.Fields[a];this.Fields[a]=this.Fields[c];this.Fields[c]=b;}return d;};this.getFieldIndex=function(c){for(var a=0;a<this.Fields.length;a++){var b=this.Fields[a];if(b.fieldName.toLowerCase()==c.toLowerCase()){return a;}}return -1;};this.getFieldByName=function(c){for(var a=0;a<this.Fields.length;a++){var b=this.Fields[a];if(b.fieldName.toLowerCase()==c.toLowerCase()){return b;}}return null;};this.getFieldByIndex=function(a){a=parseInt(a);if(a>=0&&a<this.Fields.length){return this.Fields[a];}return null;};this.getCheckBox=function(b,a){return"<input type='checkbox' name='"+a+"'  "+((b[a]==1)?"checked":"")+"/>";};this.getFieldType=function(d){var a=d.fieldType;if(a=="varchar"){a=a+"("+d.charLen+")";}else{if(a=="number"){var c=d.intLen;var b=d.decimalLen;if(b==0){a=a+"("+c+")";}else{a=a+"("+c+","+b+")";}}}return a;};this.getHtml=function(c){c=c||{showDel:true};var h=new StringBuffer();for(var d=0;d<this.Fields.length;d++){var e=(d%2==0)?"odd":"even";var g=this.Fields[d];var b=this.getFieldType(g);if(g.isHidden==1){continue;}var a=((g.isDeleted==0)?" ":"√"),f=((g.isDeleted==0)?false:true);h.append("<tr fieldName='"+g.fieldName+"' class='");h.append(e);h.append("'>");h.append("<td class='editField' name='fieldName' >"+this.delStyle(g.fieldName,f)+"</s></td>");h.append("<td class='editField' name='fieldDesc'>"+this.delStyle(g.fieldDesc,f)+"</td>");h.append("<td>"+b+"</td>");h.append("<td style='text-align:center;'>"+this.getCheckBox(g,"isRequired")+"</td>");h.append("<td style='text-align:center;' name='Listtd'>"+this.getCheckBox(g,"isList")+"</td>");if(b.indexOf("clob")!=-1||isHideFlowVar(g.controlType)){h.append("<td style='text-align:center;'>&nbsp;</td>");}else{h.append("<td style='text-align:center;'>"+this.getCheckBox(g,"isFlowVar")+"</td>");}if(c.showDel){h.append("<td style='text-align:center;'>"+a+"</td>");}h.append("<td>"+((g.isDeleted==0)?"<a href='#"+g.fieldName+"' name='editColumn'  >"+$lang.button.edit+"</a>":" ")+"</td>");h.append("</tr>");}return h.toString();};this.getFieldItem=function(h,c){var e=new StringBuffer();for(var b=0;b<this.Fields.length;b++){var f=this.Fields[b];if(f.fieldName!=h){continue;}var a=(b%2==0)?"odd":"even";var d=this.getFieldType(f);if(f.isHidden==1){continue;}var j=((f.isDeleted==0)?" ":"√"),g=((f.isDeleted==0)?false:true);e.append("<tr fieldName='"+f.fieldName+"' class='");e.append(a);e.append("'>");e.append("<td class='editField' name='fieldName' >"+this.delStyle(f.fieldName,g)+"</s></td>");e.append("<td class='editField' name='fieldDesc'>"+this.delStyle(f.fieldDesc,g)+"</td>");e.append("<td>"+d+"</td>");e.append("<td style='text-align:center;'>"+this.getCheckBox(f,"isRequired")+"</td>");e.append("<td style='text-align:center;' name='Listtd'>"+this.getCheckBox(f,"isList")+"</td>");if(d.indexOf("clob")!=-1||isHideFlowVar(f.controlType)){e.append("<td style='text-align:center;'>&nbsp;</td>");}else{e.append("<td style='text-align:center;'>"+this.getCheckBox(f,"isFlowVar")+"</td>");}if(c==1){e.append("<td style='text-align:center;' name='showdel'>"+j+"</td>");}e.append("<td>"+((f.isDeleted==0)?"<a href='#' name='editColumn'  >"+$lang.button.edit+"</a>":" ")+"</td>");e.append("</tr>");}return $(e.toString());};this.delStyle=function(a,b){if(b){return"<s>"+a+"</s>";}return a;};};var isEdited=false;if(typeof TableRow=="undefined"){TableRow={};}TableRow.setFieldManage=function(a){TableRow.fieldManage=a;};TableRow.setAllowEditColName=function(a){TableRow.allowEditColName=a;};TableRow.setIsExternal=function(a){TableRow.isExternal=a;};TableRow.isEdit=false;TableRow.setIsEdit=function(a){TableRow.isEdit=a;};TableRow.del=function(){var a=$("#tableColumnItem>tbody .over");if(a.length==0){$.ligerDialog.warn($lang_form.fieldManage.notCheckedRow,$lang.tip.msg);return;}var c=a.attr("fieldName");var b=TableRow.fieldManage.getFieldByName(c);if(b.isRequired){$.ligerDialog.warn($lang_form.fieldManage.isRequired,$lang.tip.msg);return;}TableRow.fieldManage.delField(c);a.remove();};TableRow.move=function(f){var a=$("#tableColumnItem>tbody .over");if(a.length==0){return;}var e=a.attr("fieldName");var c=TableRow.fieldManage.moveField(e,f);if(!c){return;}if(f){var d=a.prev();a.insertBefore(d);}else{var b=a.next();a.insertAfter(b);}};TableRow.addColumn=function(a){var b=TableRow.isEdit;ColumnDialog({isAdd:true,isMain:a,fieldManage:TableRow.fieldManage,isExternal:0,callBack:function(e){isEdited=true;var d=TableRow.fieldManage.isFieldExist(e.fieldName);if(d){return false;}TableRow.fieldManage.addField(e);var c=$(TableRow.fieldManage.getFieldItem(e.fieldName,TableRow.allowEditColName?0:1));c.addClass("newColumn");c.attr("style","background-color:FFE2D7;");$("#tableColumnItem>tbody").append(c);handisList();return true;}});};handisList=function(){var c=$("input[name='isMain']:checked").val();var b=$("td[name='Listtd']");var a=$("th[name='Listth']");if(c=="1"){b.show();a.show();}else{a.hide();b.hide();}};TableRow.editField=function(e,a){var b=TableRow.fieldManage.getFieldByName(e);if(b==null){return;}var c=$("tr[fieldname="+e+"]","#tableColumnItem>tbody");var d=$("[name=isFlowVar]",c).data("isFlowVar");ColumnDialog({isAdd:false,isMain:a,allowEditColName:TableRow.allowEditColName||c.hasClass("newColumn"),fieldManage:TableRow.fieldManage,field:b,isFlowVar:d,isExternal:TableRow.isExternal,callBack:function(h){if(TableRow.fieldManage.isFieldExist(h.fieldName)){TableRow.fieldManage.updField(h);}else{TableRow.fieldManage.replaceByFieldName(e,h);}var g=1;if(TableRow.allowEditColName||TableRow.isExternal==1){g=0;}var f=$(TableRow.fieldManage.getFieldItem(h.fieldName,g));if(c.length>0){$("[name=isFlowVar]",f).data("isFlowVar",d);if(!TableRow.allowEditColName){if(d){$("[name=isFlowVar]:checked",f).each(function(){var i=$(this);i.attr("disabled","disabled");});}}c.replaceWith(f);}else{f.data("isFlowVar",d);$("#tableColumnItem>tbody").append(f);}if(tableId!=0){isEdited=true;$("#tableColumnItem>tbody>tr:[fieldname="+h.fieldName+"]").attr("style","background-color:#FFE2D7;");}handisList();return true;}});};TableRow.editNameComment=function(b){var c=b.parent();var a=$("#tableColumnItem>tbody>tr").index(c);var d=TableRow.fieldManage.getFieldByIndex(a);var g=b.attr("name");if(!TableRow.allowEditColName&&!c.hasClass("newColumn")){if(g=="fieldName"){return;}}var f=b.has("input").length==1;if(!f){var e=$("<input type='text' class='inputText' maxlength='20' size='20' value='"+b.text()+"' />");e.blur(function(){var i=$(this);var h=i.val();i.parent().text(h);i.remove();d[g]=h;if(tableId!=0){isEdited=true;$("#tableColumnItem>tbody>tr:[fieldname="+d.fieldName+"]").attr("style","background-color:#FFE2D7;");}});b.empty();b.append(e);e.focus();}};TableRow.editFieldOption=function(b){var f=b.attr("name");var d=b.attr("checked");var c=b.parents("tr");var a=$("#tableColumnItem>tbody>tr").index(c);var e=TableRow.fieldManage.getFieldByIndex(a);e[f]=(d!=undefined)?1:0;};function autoGetKey(inputObj){var subject=$(inputObj).val();if($.trim(subject).length<1){return;}$.ajax({url:__ctx+"/platform/form/bpmFormTable/getFieldKey.ht",type:"POST",data:({subject:subject}),success:function(data){var json=eval("("+data+")");if(json.result==1&&$.trim($("#fieldName").val()).length<1){$("#fieldName").val(json.message);validateField().form();}}});}