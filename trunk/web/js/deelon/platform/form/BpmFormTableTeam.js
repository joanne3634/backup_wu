var colstree;if(typeof BpmFormTableTeam=="undefined"){BpmFormTableTeam={};}BpmFormTableTeam.getFieldsByTableId=function(tableId){var iconFolder=__ctx+"/styles/tree/";$.post("getFieldsByTableId.ht?tableId="+tableId,function(data){var json=eval("("+data+")"),treeData=[];for(var i=0,c;c=json.fields[i++];){c.name=c.fieldDesc;c.id=c.fieldName;c.pId=0;c.icon=iconFolder+c.fieldType+".png";treeData.push(c);}var setting={view:{fontCss:setFontCss},data:{key:{name:"name"},simpleData:{enable:true,idKey:"id",pIdKey:"pId",rootPId:0}},callback:{onDblClick:function(event,treeId,treeNode){BpmFormTableTeam.addField(treeId,treeNode);}}};colstree=$.fn.zTree.init($("#colstree"),setting,treeData);});};function setFontCss(treeId,treeNode){if($.isEmpty(team)){return"";}var v=eval("("+team+")"),p=[];for(var i=0,c;c=v.team[i++];){for(var j=0,o;o=c.teamField[j++];){p.push(o.fieldName);}}if($.isEmpty(p)){return"";}for(var i=0,c;c=p[i++];){if(c==treeNode.id){return{color:"red"};}}return"";}function removeOpt(c){var b=$(c);var d=b.val();if($.isEmpty(d)){return;}c.remove(c.selectedIndex);if(colstree){var a=colstree.getNodesByFilter(function(e){return e.id==d?true:false;},true);setCss(a.tId,"");}}function setCss(b,a){if($.isEmpty(b)){return;}$("#"+b+"_a").css("color",a);}function parseTeam(o){if($.isEmpty(o)){return;}var v=eval("("+o+")");if(v.isShow){$("#isShow").attr("checked","checked");$("#showPosition").val(v.showPosition);$("#showPosition").show();}else{$("#isShow").attr("checked",false);$("#showPosition").hide();}for(var i=0,c;c=v.team[i++];){add(false,c);}}function add(b,f){var e=$($("#cloneTemplate [zone='team']")[0]).clone(true,true);if(!b){var d=[];for(var a=0,g;g=f.teamField[a++];){d.push('<option value="'+g.fieldName+'">'+g.fieldDesc+"</option>");}$("[name='teamName']",e).val(f.teamName);$("[name='teamField']",e).append(d.join(""));}$("[var=del]",e).click(function(c){$.ligerDialog.confirm($lang_form.bpmFormTableTeam.delTeam,$lang.tip.msg,function(h){if(h){e.fadeOut(500,function(){$(this).remove();});}});});$("#teamItem").append(e);$("select[name='teamField']",e).each(function(){selectTeam(this);});}function selectTeam(b){var a=$("#teamItem");$(".validError",a).each(function(){$(this).removeClass("validError");$(this).closest("table").css("border","");});$(b).addClass("validError");$(b).closest("table").css("border","1px solid red");}BpmFormTableTeam.addField=function(e,d){var f=d.id,c=d.name,a=$(".validError"),b=false;$("#teamItem select[name='teamField'] option").each(function(){if(f==$(this).val()){b=true;}});if(b){alert($lang_form.bpmFormTableTeam.moveAdd);return;}if(!a||a.length==0){alert($lang_form.bpmFormTableTeam.selectAddTeam);return;}__SelectOption__.add(a.get(0),c,f);setCss(d.tId,"red");};function saveData(){var rtn=valid.valid();if(!rtn){return false;}$(".validError").removeClass("validError");var team=[],json={};$("#teamItem .table-detail").each(function(){var me=$(this),data={},teamField=[];data.teamName=$("input[name='teamName']",me).val();me.find("select[name='teamField'] option").each(function(){var o={};o.fieldName=$(this).val();o.fieldDesc=$(this).text();teamField.push(o);});if(!teamField||teamField.length==0){rtn=false;}data.teamField=teamField;team.push(data);});if(!rtn){alert($lang_form.bpmFormTableTeam.selectTeamField);return false;}json.isShow=$("#isShow").is(":checked");json.showPosition=$("#showPosition").val();json.team=team;json=JSON2.stringify(json);var url=__ctx+"/platform/form/bpmFormTable/teamSave.ht";$.post(url,{tableId:tableId,json:json},function(d){var result=eval("("+d+")");if(result.success){$.ligerDialog.success(result.msg,$lang.tip.msg,function(){window.close();});}else{$.ligerDialog.error(result.msg,$lang.tip.errorMsg);}});}