if(typeof AttachMent=="undefined"){AttachMent={};}AttachMent.addFile=function(e){var c=$(e);var j=c.attr("field");var i=c.parent().parent();var a="w";var g="div.attachement";var h="input[name='"+j+"'],textarea[name='"+j+"']";var b=$(g,i);var f=$(h,i);var d=AttachMent.getFileJsonArray(b);FlexUploadDialog({isSingle:false,callback:function(s,l,r,n){if(s==undefined||s==""){return;}var m=s.split(",");var q=l.split(",");var u=n.split(",");for(var o=0;o<m.length;o++){var k=q[o];AttachMent.addJson(m[o],k,d);}var t=JSON2.stringify(d);var p=AttachMent.getHtml(d,a);b.empty();b.append($(p));f.val(t);CustomForm.validate();}});};AttachMent.directUpLoadFile=function(e){var c=$(e);var j=c.attr("field");var i=c.parent().parent();var a="w";var g="div.attachement";var h="input[name='"+j+"'],textarea[name='"+j+"']";var b=$(g,i);var f=$(h,i);var d=AttachMent.getFileJsonArray(b);DirectUploadDialog({callback:function(p,q){if(q==undefined||q==[]){return;}for(var o=0;o<q.length;o++){var k=q[o].fileId;var l=q[o].fileName;AttachMent.addJson(k,l,d);}var n=JSON2.stringify(d);var m=AttachMent.getHtml(d,a);b.empty();b.append($(m));f.val(n);CustomForm.validate();}});};AttachMent.delFile=function(g){var d=$(g);var h=d.parent();var c=h.parent();var a=$("span[name='attach']",h);var j=c.parent();var b=a.attr("fileId");var e=AttachMent.getFileJsonArray(c);AttachMent.delJson(b,e);var i=JSON2.stringify(e);var f=$("textarea",j);if(e.length==0){i="";}f.val(i);h.remove();CustomForm.validate();};AttachMent.init=function(b,a){if($.isEmpty(a)){a=$("div[name='div_attachment_container']");}a.each(function(){var f=$(this),g=f.attr("right");if(!g){g=f.closest("[type='subtable']").attr("right");}if(!$.isEmpty(b)){g=b;}if(g){g=g.toLowerCase();}if(g!="w"&&g!="r"&&g!="b"){f.remove();}else{if(g=="r"){$("a.attachement").remove();}var e=$("textarea[controltype='attachment']",f);var c=e.val();if(!$.isEmpty(c)){c=c.replaceAll("￥@@￥",'"');e.val(c);}var d=$("div.attachement",f);AttachMent.insertHtml(d,c,g);}});};AttachMent.insertHtml=function(g,a,d){if($.isEmpty(a)){g.empty();return;}if($.isEmpty(d)){d="r";}var f=[];try{a=a.replaceAll("￥@@￥",'"');f=jQuery.parseJSON(a);}catch(c){}var b=AttachMent.getHtml(f,d);g.empty();g.append($(b));};AttachMent.getHtml=function(g,d){var l="";var m="";var a="<span class='attachement-span'><span fileId='#fileId#' name='attach' file='#file#' ><a class='attachment' target='_blank' path='#path#' onclick='AttachMent.handleClickItem(this)' title='#title#'>#name#</a></span><a href='javascript:;' onclick='AttachMent.download(this);' title='下载' class='download'></a>&nbsp;<a href='javascript:;' onclick='AttachMent.delFile(this);' class='cancel'></a></span>";var f="<span class='attachement-span'><span fileId='#fileId#' name='attach' file='#file#' ><a class='attachment' target='_blank' path='#path#' onclick='AttachMent.handleClickItem(this)' title='#title#'>#name#</a></span><a href='javascript:;' onclick='AttachMent.download(this);' title='下载' class='download'></a></span>";if(d=="w"){m=a;}else{m=f;}for(var k=0;k<g.length;k++){var j=g[k];var c=j.id;var b=j.name;var n=__ctx+"/platform/system/sysFile/file_"+j.id+".ht";var e=c+","+b;var h=m.replace("#file#",e).replace("#path#",n).replace("#name#",AttachMent.parseName(b)).replace("#title#",b).replace("#fileId#",c);l+=h;}return l;};AttachMent.parseName=function(a){if(a.length>10){return a.substr(0,6)+"...";}return a;};AttachMent.addJson=function(a,b,e){var c=AttachMent.isFileExist(e,a);if(!c){var d={id:a,name:b};e.push(d);}};AttachMent.delJson=function(a,d){for(var b=d.length-1;b>=0;b--){var c=d[b];if(c.id==a){d.splice(b,1);}}};AttachMent.isFileExist=function(d,a){for(var b=0;b<d.length;b++){var c=d[b];if(c.id==a){return true;}}return false;};AttachMent.getFileJsonArray=function(a){var b=[];var c=$("span[name='attach']",a);c.each(function(e){var f=$(this);var d=f.attr("file");var g=d.split(",");var f={id:g[0],name:g[1]};b.push(f);});return b;};AttachMent.handleClickItem=function(e){var f=$(e);var c=f.closest("span");var a=c.attr("fileId");var b=__ctx+"/platform/system/sysFile/getJson.ht";var d;$.ajax({url:b,data:{fileId:a},success:function(k){if(typeof(k)=="string"){$.ligerDialog.error($lang.tip.timeout,$lang.tip.msg);return;}if(k.status!=1){$.ligerDialog.error(k.msg,$lang.tip.msg);}else{d=k.sysFile;var m=f.attr("path");if(/(doc)|(docx)|(xls)|(xlsx)|(ppt)|(pptx)/ig.test(d.ext)){if($.browser.msie){window.open(m,"_blank");}else{var j=screen.availHeight-35;var g=screen.availWidth-5;var l="top=0,left=0,height="+j+",width="+g+",status=no,toolbar=no,menubar=no,location=no,resizable=1,scrollbars=1";var i=__ctx+"/platform/form/office/get.ht?fileId="+a;window.open(i,"myWindow",l);}}else{window.open(m,"_blank");}}}});};AttachMent.download=function(e){var c=$(e);var b=c.siblings("span");if(b.length>0){var a=b.attr("fileId");}var d=__ctx+"/platform/system/sysFile/file_"+a+".ht?download=true";window.open(d,"_blank");};