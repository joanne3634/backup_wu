$(function(){CustomForm={subFileJsonMap:null,subFileJsonType:true,onEditCallBack:null,tables:{},init:function(){var self=this;self.isMainTableRequest();if(typeof subFilePermissionMap!="undefined"&&subFilePermissionMap!=null){self.subFileJsonMap=subFilePermissionMap;var subFileJsonList=self.subFileJsonMap["subFileJsonList"];var oldSubFileJsonList=self.subFileJsonMap["oldSubFileJsonList"];var subTableShowList=self.subFileJsonMap["subTableShowList"];if(subFileJsonList!=undefined&&subFileJsonList!=null&&subFileJsonList.length>0){self.subFileJsonType=true;self.newSubTablePermission(self,subFileJsonList,subTableShowList);}else{self.subFileJsonType=false;self.oldSubTablePermission(self,oldSubFileJsonList);}self.initUI();self.initComdify();self.validate();}},newSubTablePermission:function(obj,subFileJsonList,subTableShowList){$("div[type=subtable]").each(function(){var table=$(this);var tableName=table.attr("tableName");for(var cn=0;cn<subTableShowList.length;cn++){var tableShow=subTableShowList[cn];if(tableName==tableShow.tableName){if(tableShow.show=="y"){table.attr("show","false");table.attr("right","w");}else{table.attr("show","true");if(tableShow.show=="r"){$("a.add,a.link",table).remove();table.attr("right","r");}else{table.attr("right",tableShow.show);}}break;}}var show=table.attr("show");if(typeof show!="undefined"&&show!="true"){table.attr("style","display:none;");}var subList=[];for(var i=0;i<subFileJsonList.length;i++){var objPermission=subFileJsonList[i];if(tableName==objPermission.tableName){var right=objPermission.power;var name="s:"+tableName+":"+objPermission.title;if(right!="w"&&right!="b"){$("a.link",table).each(function(){var link=$(this);if(name==link.attr("name")||name==link.attr("field")){link.remove();}});$("a.extend",table).each(function(){var extend=$(this);var jsonStr=extend.attr("dialog");if(jsonStr!=null&&"undefined"!=jsonStr.toLowerCase()&&jsonStr.length>2){var jsonObj=eval("("+jsonStr+")");var fileds=jsonObj.fields;for(var i=0;i<fileds.length;i++){var filedName="s:"+tableName+":"+fileds[i].target;if(filedName==name){extend.remove();break;}}}});$("input:visible,textarea:visible,select:visible",table).each(function(){var me=$(this);if(name==me.attr("name")){me.attr("right",right);var isSelect=me.is("select");var isTextarea=me.is("textarea");var isCheckboxOrRadio=false;var type=me.attr("type");if(type=="checkbox"||type=="radio"){isCheckboxOrRadio=true;}var val="";var validRule=me.attr("validate");if(validRule!=null&&validRule!=""&&"undefined"!=validRule.toLowerCase()){var json=eval("("+validRule+")");if(json.isWebSign){var lablename=me.attr("lablename");if(isSelect){val='<input name="'+name+'"  lablename="'+lablename+'" type="hidden" validate="{\'isWebSign\':true}" value="'+me.attr("val")+'" />';}else{if(isTextarea){val='<textarea name="'+name+'" lablename="'+lablename+'" class="hidden"  validate="{\'isWebSign\':true}" >'+me.val()+"</textarea>";}else{val='<input name="'+name+'"  lablename="'+lablename+'"  type="hidden" validate="{\'isWebSign\':true}" value="'+me.val()+'" />';}}}}if(isSelect){val+=obj.selectValue(me);me.before(val);me.remove();}else{if(isCheckboxOrRadio){me.attr("disabled","disabled");}else{val+=me.val();var refid=me.attr("refid");if(typeof(refid)!=undefined&&refid!=null&&refid!=""){var refids=me.prev("input[name='"+refid+"']").val();var linkType=me.attr("linktype");var tempval="<div>";var nametemp=new Array();var str=me.val();if(typeof(str)!=undefined&&str!=null&&str!=""){nametemp=str.split(",");}if(refids){var id=refids.split(",");for(var i=0;i<id.length;i++){tempval+="<span class='backgrounddiv'><a refid='"+id[i]+"' href='#' linktype='"+linkType+"' style='text-decoration:none'>"+nametemp[i]+"</a> </span>";}}else{for(var i=0;i<nametemp.length;i++){tempval+="<span class='backgrounddiv'>"+nametemp[i]+"</span>";}}tempval+="</div>";val=tempval;}me.before(val);me.remove();}}}});}else{if(right=="b"){$("input:visible,textarea:visible,select:visible,a:visible",table).each(function(){var me=$(this);me.attr("right",right);var isSelect=me.is("a");var objName="";if(isSelect){objName=me.attr("field");}else{objName=me.attr("name");}if(name==objName){var validRule=me.attr("validate");if(validRule!=null&&"undefined"!=validRule.toLowerCase()&&validRule.length>2){var json=eval("("+validRule+")");if(json.required){}else{var jsonStr=validRule.substring(0,validRule.lastIndexOf("}"));jsonStr+=",'required':true}";me.attr("validate",jsonStr);}}else{me.attr("validate","{'required':true}");}}});}}}}var row=table.find("[formType=form]");var form;if(row.length>0){form=table.find("[formType=window]");}else{row=table.find("[formType=edit]");}table.data("row",$("<div></div>").append(row.clone()).html());row.css("display","none").html("");if(form){$("div[name='div_attachment_container']",form).each(function(){var atta=$("textarea[controltype='attachment']",$(this));var attaName=atta.attr("name");if($.isEmpty(attaName)){return true;}$("td[fieldname='"+attaName+"']",table).each(function(){AttachMent.insertHtml($(this),$(this).text());});});table.data("form","<form>"+$("<div></div>").append(form.clone()).html()+"</form>");table.data("formProperty",{width:form.width(),height:form.height()});form.remove();}obj.tables[tableName]=table;var right=table.attr("right");var canWrite=(right=="w"||right=="b");var canRead=canWrite||(right=="r");$(this).find('[formType="newrow"]').each(function(){if(canWrite){obj.addBind($(this),table);}});if(canWrite){var menu=$.ligerMenu({top:100,left:100,width:130,items:[{text:"添加",click:function(){obj.add($(menu.target).closest("div[type=subtable]"));}}]});table.find("[formType]:first").prev().bind("contextmenu",function(e){menu.target=e.target;menu.show({top:e.pageY,left:e.pageX});return false;});}if(!canRead){$(this).hide();}obj.handButton(table,canWrite);if(right=="b"&&table.find("[formtype]:visible").length<1){if(!(table.hasClass("validError"))){table.addClass("validError");}}});},oldSubTablePermission:function(obj,oldSubFileJsonList){$("div[type=subtable]").each(function(){var table=$(this);var show=table.attr("show");if(typeof show!="undefined"&&show!="true"){table.attr("style","display:none;");}var tableName=table.attr("tableName");table.attr("right","w");for(var i=0;i<oldSubFileJsonList.length;i++){var objPermission=oldSubFileJsonList[i];if(tableName==objPermission.title){table.attr("right",objPermission.power);break;}}var row=table.find("[formType=form]");var form;if(row.length>0){form=table.find("[formType=window]");}else{row=table.find("[formType=edit]");}table.data("row",$("<div></div>").append(row.clone()).html());row.css("display","none").html("");if(form){$("div[name='div_attachment_container']",form).each(function(){var atta=$("textarea[controltype='attachment']",$(this));var attaName=atta.attr("name");if($.isEmpty(attaName)){return true;}$("td[fieldname='"+attaName+"']",table).each(function(){AttachMent.insertHtml($(this),$(this).text());});});table.data("form","<form>"+$("<div></div>").append(form.clone()).html()+"</form>");table.data("formProperty",{width:form.width(),height:form.height()});form.remove();}obj.tables[tableName]=table;var right=table.attr("right");var canWrite=(right=="w"||right=="b");var canRead=canWrite||(right=="r");$(this).find('[formType="newrow"]').each(function(){if(canWrite){obj.addBind($(this),table);}});if(canWrite){var menu=$.ligerMenu({top:100,left:100,width:130,items:[{text:"添加",click:function(){obj.add($(menu.target).closest("div[type=subtable]"));}}]});table.find("[formType]:first").prev().bind("contextmenu",function(e){menu.target=e.target;menu.show({top:e.pageY,left:e.pageX});return false;});}if(!canRead){$(this).hide();}obj.handButton(table,canWrite);});},handButton:function(table,canWrite){var self=this;if(!canWrite){$(".add",table).addClass("disabled");$(".del",table).addClass("disabled");return;}$(".add",table).click(function(){self.add(table);});table.delegate(".del","click",function(){var t=$(this).closest("[formType]"),brother=t.next("[formType]").length?t.next("[formType]"):t.prev("[formType]");t.remove();if(brother){FormUtil.InitMathfunction(brother);}});},initComdify:function(){$("div[type='custform']").delegate("[showtype]","blur",function(){var value=$(this).val();var json=null;try{var jsonStr=$(this).attr("showtype");json=eval("("+jsonStr+")");}catch(err){}if(json!=null){var coinvalue=json.coinValue;var iscomdify=json.isShowComdify;var decimallen=json.decimalValue;if(coinvalue!=null&&coinvalue!=""){if(value.split(coinvalue)!=-1){var ary=value.split(coinvalue);value=ary.join("");}}if(value.indexOf(",")!=-1){value=$.toNumber(value);}if(iscomdify){var value=$.comdify(value);}if(decimallen>0&&value!=""){if(value.indexOf(".")!=-1){var ary=value.split(".");var temp=ary[ary.length-1];if(temp.length>0&&temp.length<decimallen){var zeroLen="";for(var i=0;i<decimallen-temp.length;i++){zeroLen=zeroLen+"0";}value=value+zeroLen;}}else{var zeroLen="";for(var i=0;i<decimallen;i++){zeroLen=zeroLen+"0";}value=value+"."+zeroLen;}}if(coinvalue!=null&&coinvalue!=""&&value!=""){value=coinvalue+value;}}$(this).val(value);});},initUI:function(parent){$('input[type="checkbox"]').each(function(){var value=$(this).val();var data=$(this).attr("data");if(!data||data==""||data=="null"){return;}var ary=data.split(",");for(var i=0;i<ary.length;i++){if(value==ary[i]){$(this).attr("checked","checked");}}});var filter="input,textarea,.dicComboTree,.dicComboBox,.dicCombo";if(parent==undefined){parent=$("body div[type=custform]");if(!parent||parent.length==0){parent=$("body");}}else{AttachMent.init("w",$("div[name='div_attachment_container']",parent));}$("select[name][val]",parent).each(function(){var obj=$(this),val=obj.attr("val");if($.isEmpty(val)){val=obj.val();}obj.val(val);});parent.find(filter).each(function(){if($(this).is(".dicComboTree,.dicComboBox,.dicCombo")){$(this).htDicCombo();}if($(this).is(".Wdate[displayDate=1]")){var me=$(this);if($.isEmpty(me.val())){var datefmt=me.attr("datefmt");var nowDate=new Date().Format(datefmt);me.val(nowDate);}}});if(parent.is("form")){parent.data("validate",this.getValidate(parent));}else{var v=parent.closest("form");this.valid=this.getValidate(v);}},add:function(table,beforeElement){var self=this;var right=table.attr("right");if(right!="w"&&right!="b"){return;}var frm=table.data("form");if(frm){self.openWin("添加",$(frm),table,beforeElement,function(form,table,beforeElement){var v=form.data("validate");if(!v.valid()){return false;}else{var row=$(table.data("row"));self.addRow(row,form);self._add(table,row,beforeElement);return true;}});}else{var row=$(table.data("row"));this._add(table,row,beforeElement);}},addRow:function(row,form){form.find("input:text[name],input:hidden[name], textarea[name],select[name]").each(function(){var name=$(this).attr("name");var val=$(this).val();row.append($('<input type="hidden"/>').attr("name",name).val(val));var filter="[fieldName='"+name+"']";var objTd=$(filter,row);if(objTd.length>0){var controltype=$(this).attr("controltype");if(!$.isEmpty(controltype)&&controltype=="attachment"){AttachMent.insertHtml(objTd,val);}else{if(!$.isEmpty(controltype)&&controltype=="select"){var text=$(this).find("option:selected").text();objTd.text(text);}else{objTd.text(val);}}}$(this).val("");});form.find("input:checkbox,input:radio").each(function(){var name=$(this).attr("name");var value=$(this).val();var filterHidden="input[name='"+name+"']";var isChecked=($(this).attr("checked")!=undefined);var obj=$(filterHidden,row);var filter="[fieldName='"+name+"']";var objTd=$(filter,row);var val=(isChecked)?value:"";if(obj.length==0){row.append($('<input type="hidden"/>').attr("name",name).val(val));if(objTd.length>0){objTd.text(val);}}else{var existVal=obj.val();if(existVal==""){if(val!=""){existVal=val;}}else{if(val!=""){existVal+=","+val;}}obj.val(existVal);if(objTd.length>0){objTd.text(existVal);}}});},_add:function(table,newRow,beforeElement){$("input,textarea,select",newRow).each(function(){var me=$(this);if(me.is(".Wdate[displayDate=1]")){if($.isEmpty(me.val())){var datefmt=me.attr("datefmt");var nowDate=new Date().Format(datefmt);me.val(nowDate);}}var validRule=me.attr("validate");if(validRule!=null&&"undefined"!=validRule.toLowerCase()&&validRule.length>2){var json=eval("("+validRule+")");if(json.required){me.addClass("validError");}}});if(beforeElement){$(beforeElement).before(newRow);}else{table.find("[formType]:last").after(newRow);}this.initUI(newRow);this.addBind(newRow,table);FormUtil.triggerChoice(newRow);if(table.hasClass("validError")){table.removeClass("validError");}},addBind:function(row,table){var needEdit=(this.tables[table.attr("tableName")].data("form")!=null);var menu=this.getMenu(needEdit);row.bind("contextmenu",function(e){menu.target=e.target;menu.show({top:e.pageY,left:e.pageX});return false;});},edit:function(table,row){var self=this;var tableName=table.attr("tableName");var form=$(this.tables[tableName].data("form"));self.initFormData(form,row);form.data("row",row);this.openWin("编辑",form,table,null,function(form,table){var v=form.data("validate");var rtn=v.valid();if(!rtn){return false;}var row=form.data("row");self.setRowData(form,row);return true;});},initFormData:function(form,row){form.find('input:text,textarea,select,input[type="hidden"]').each(function(){var name=$(this).attr("name");var value=row.find('[name="'+name+'"]').val();$(this).val(value);});form.find("input:checkbox,input:radio").each(function(){var name=$(this).attr("name");var chkValue=$(this).val();var value=row.find('[name="'+name+'"]').val();if(value.indexOf(chkValue)!=-1){$(this).attr("checked","checked");}});},setRowData:function(form,row){var self=this;form.find('input:text, textarea,input[type="hidden"],select').each(function(){var name=$(this).attr("name");var val=$(this).val();var objHidden=$("input[name='"+name+"']",row);objHidden.val(val);var filter="[fieldName='"+name+"']";var objTd=$(filter,row);if(objTd.length>0){var controltype=$(this).attr("controltype");if(!$.isEmpty(controltype)&&controltype=="attachment"){AttachMent.insertHtml(objTd,val);}else{objTd.text(val);}}});form.find("input:checkbox,input:radio").each(function(){var name=$(this).attr("name");var objHidden=$("input[name='"+name+"']",row);objHidden.val("");var filter="[fieldName='"+name+"']";var objTd=$(filter,row);if(objTd.length>0){objTd.text("");}});form.find("input:checkbox:checked,input:radio:checked").each(function(){var name=$(this).attr("name");var value=$(this).val();var objHidden=$("input[name='"+name+"']",row);var filter="[fieldName='"+name+"']";var objTd=$(filter,row);var hidValue=objHidden.val();if(self.isNull(hidValue)){objHidden.val(value);objTd.text(value);}else{objHidden.val(hidValue+","+value);objTd.text(hidValue+","+value);}});},isNull:function(obj){if(obj==undefined||obj==null||obj==""){return true;}return false;},getValidate:function(target){return target.form({errorPlacement:function(el,msg){var element=$(el),corners=["right center","left center"],flipIt=element.parents("span.right").length>0;element.addClass("validError");if(element.hasClass("ckeditor")){setTimeout(function(){element=element.next();element.css("border","1px solid red");},1000);}else{if(element.hasClass("Wdate")||element.is("textarea")){element.css("border","1px solid red");}else{if(element.is("select")||element.attr("type")&&(element.attr("type")=="checkbox"||element.attr("type")=="radio")){var name=element.attr("name");if(!name){return;}var priElement=$("*[name='"+name+"']",$("span.select_contain_span"));if(priElement.length>0){return;}element.removeClass("validError");var errorSpan=$("<span></span>").css({"border":"1px solid red","padding":"1px"}).addClass("select_contain_span");element.before(errorSpan);errorSpan.append(element);}}}if(!$(msg).is(":empty")){element.qtip({overwrite:false,content:msg,position:{my:corners[flipIt?0:1],at:corners[flipIt?1:0],viewport:$(window)},show:{effect:function(offset){$(this).slideDown(100);}},hide:{event:"click mouseleave",leave:false,fixed:true,delay:200},style:{classes:"ui-tooltip-red"}});}else{element.qtip("destroy");}},success:function(el){var element=$(el);if(element.hasClass("ckeditor")){element=element.next();element.css("border","");}else{if(element.hasClass("Wdate")||element.is("textarea")){element.css("border","1px solid #999");}else{if(element.is("select")||element.attr("type")&&(element.attr("type")=="checkbox"||element.attr("type")=="radio")){var selectSpan=element.parents("span.select_contain_span");if(!selectSpan||selectSpan.length==0){var name=element.attr("name");if(!name){return;}var priElement=$("*[name='"+name+"']",$("span.select_contain_span"));if(!priElement||priElement.length==0){return;}var tipSpan=priElement.parents("span.select_contain_span");var formtype=priElement.parents("[formtype]");if(formtype&&formtype.length>0){$("[name='"+name+"']",formtype).each(function(){$(this).removeClass("validError");$(this).qtip("destroy");$(this).unbind("mouseover");});}else{$("[name='"+name+"']").each(function(){$(this).removeClass("validError");$(this).qtip("destroy");$(this).unbind("mouseover");});}tipSpan.before(priElement);tipSpan.remove();}else{selectSpan.before(element);selectSpan.remove();}}}}element.removeClass("validError");element.qtip("destroy");element.unbind("mouseover");},rules:com.deelon.form.rule.CustomRules});},validate:function(conf){return this.valid.valid(conf);},handNumberData:function(obj){var value=$(obj).val();var showType=$(obj).attr("showtype");if(showType){try{var json=jQuery.parseJSON(showType);var coinvalue=json.coinValue;var isShowComdify=json.isShowComdify;if(coinvalue!=null&&coinvalue!=""){if(value.split(coinvalue)!=-1){var ary=value.split(coinvalue);value=ary.join("");}}if(isShowComdify){if(value.split(",")!=-1){var temp=value.split(",");value=temp.join("");}}}catch(err){}}return value;},getData:function(){var self=this;var main={fields:{}};$("input:text[name^='m:'],input:hidden[name^='m:'],textarea[name^='m:'],select[name^='m:']").each(function(){var name=$(this).attr("name");var value=self.handNumberData(this);main.fields[name.replace(/.*:/,"")]=value;});$("textarea[name^='m:'].ckeditor").each(function(){var name=$(this).attr("name");var data=CKEDITOR.instances[name].getData();main.fields[name.replace(/.*:/,"")]=data;$(this).val(data);});self.setMainRadioData(main.fields);self.setMainCheckBoxData(main.fields);var sub=[];$("div[type=subtable][right=w || right=b][show=true||undefined]").each(function(){var table={tableName:$(this).attr("tableName"),fields:[]};$(this).find("[formtype]:visible").each(function(){var row={};var objRow=$(this);$("input:text[name^='s:'],input[type='hidden'][name^='s:'],textarea[name^='s:'],select[name^='s:']",objRow).each(function(){var name=$(this).attr("name").replace(/.*:/,"");var value=self.handNumberData(this);row[name]=value;});self.setSubCheckBoxData(objRow,row);self.setSubRadioData(objRow,row);table.fields.push(row);});sub.push(table);JSON2.stringify(sub);});var opinion=[];$("textarea[name^=opinion]").each(function(){opinion.push({name:$(this).attr("name").split(":")[1],value:$(this).val()});});var data={main:main,sub:sub,opinion:opinion};return JSON2.stringify(data);},setSubCheckBoxData:function(objParent,dataObj){$("input:checkbox",objParent).each(function(){var name=$(this).attr("name").replace(/.*:/,"");dataObj[name]="";});$("input:checkbox:checked",objParent).each(function(){var name=$(this).attr("name").replace(/.*:/,"");var value=$(this).val();if(dataObj[name]==""){dataObj[name]=value;}else{dataObj[name]+=","+value;}});},setSubRadioData:function(objParent,dataObj){$("input:radio",objParent).each(function(){var name=$(this).attr("name").replace(/.*:/,"");var value=$(this).val();if($(this).attr("checked")!=undefined){dataObj[name]=value;}});},setMainRadioData:function(dataObj){$("input[name^=m]:radio").each(function(){var name=$(this).attr("name").replace(/.*:/,"");var value=$(this).val();if($(this).attr("checked")!=undefined){dataObj[name]=value;}});},setMainCheckBoxData:function(dataObj){$("input[name^=m]:checkbox").each(function(){var name=$(this).attr("name").replace(/.*:/,"");dataObj[name]="";});$("input[name^=m]:checkbox:checked").each(function(){var name=$(this).attr("name").replace(/.*:/,"");var value=$(this).val();if(dataObj[name]==""){dataObj[name]=value;}else{dataObj[name]+=","+value;}});},openWin:function(title,form,table,beforeElement,callback){var formProperty=table.data("formProperty");var width=formProperty.width+20;var height=formProperty.height+100;var self=this;form.data("beforeElement",beforeElement);var win=$.ligerDialog({target:form,left:($(window).width()-400)/2,top:($(window).height()-300)/2,width:width,height:height,title:title,showMax:true,showToggle:true,onClose:true,showButton:true,buttons:[{text:"确定",onclick:function(item,dialog){var result=callback(form,table,form.data("beforeElement"));if(result){if(self.onEditCallBack!=null){self.onEditCallBack(title);}dialog.close();}}}]});this.initUI(form);win.show();},getMenu:function(needEdit){var self=this;if((needEdit&&this.menuWithEdit)||(!needEdit&&this.menu)){return needEdit?this.menuWithEdit:this.menu;}else{var menu;var items=[{text:"在前面插入记录",click:function(){var row=$(menu.target).closest("[formType]");var table=row.closest("div[type=subtable]");self.add(table,row);}},{text:"在后面插入记录",click:function(){var row=$(menu.target).closest("[formType]");var table=row.closest("div[type=subtable]");row=row.next("[formType]:visible");if(row.length==0){row=null;}self.add(table,row);}},{line:true},{text:"编辑",click:function(){var row=$(menu.target).closest("[formType]");var table=row.closest("div[type=subtable]");self.edit(table,row);}},{text:"删除此记录",click:function(){var t=$(menu.target).closest("[formType]"),brother=t.next("[formType]").length?t.next("[formType]"):t.prev("[formType]");t.remove();if(brother){FormUtil.InitMathfunction(brother);}}},{line:true},{text:"向上移动",click:function(){var t=$(menu.target).closest("[formType]");var prev=t.prev("[formType]:visible");if(prev.length>0){prev.before(t);}}},{text:"向下移动",click:function(){var t=$(menu.target).closest("[formType]");var next=t.next("[formType]:visible");if(next.length>0){next.after(t);}}}];if(!needEdit){items.splice(3,1);}menu=$.ligerMenu({top:100,left:100,width:130,items:items});if(needEdit){this.menuWithEdit=menu;}else{this.menu=menu;}return menu;}},loadSubTablePermission:function(){var defId=$(":hidden[name=defId]").val();var actDefId=$(":hidden[name=actDefId]").val();var formKey=$(":hidden[name=formKey]").val();var nodeId=$(":hidden[name=nodeId]").val();var params={defId:defId,actDefId:actDefId,formKey:formKey,nodeId:nodeId};var url="getSubTablePermission.ht";var map=null;$.ajaxSetup({async:false});$.post(url,params,function(data){map=data;});$.ajaxSetup({async:true});return map;},selectValue:function(select){var html="";var query=select.attr("selectquery");var queryJson;if(query!=undefined&&query!=null){query=query.replaceAll("'",'"');queryJson=JSON2.parse(query);}else{queryJson="";query="";}var sValue=select.attr("val");if(sValue==undefined||sValue==null&&sValue.length<=0){sValue="";}var search=queryJson.search;if(search=="1"){html="<span selectvalue="+sValue+" selectquery="+query+"><lable></lable></span>";}else{if(sValue==""){html=select.find("option:selected").text();}else{html+=select.find("option[value='"+sValue+"']").text();}}return html;},isMainTableRequest:function(){$("div[name=div_attachment_container]").each(function(){var div_me=$(this);if(div_me.attr("right")=="b"){$("a.link",div_me).each(function(){var me=$(this);var validRule=me.attr("validate");if(validRule!=null&&"undefined"!=validRule.toLowerCase()&&validRule.length>2){var json=eval("("+validRule+")");if(json.required){}else{var jsonStr=validRule.substring(0,validRule.lastIndexOf("}"));jsonStr+=",'required':true}";me.attr("validate",jsonStr);}}else{me.attr("validate","{'required':true}");}});}});}};CustomForm.init();});