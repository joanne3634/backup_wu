var subTree,subHeight;$(function(){$("#layout").ligerLayout({leftWidth:250,height:"100%",allowLeftResize:false});subTree=new SubRightsTree("subTree",{url:__ctx+"/platform/form/bpmFormTable/getSubTree.ht",params:{tableId:tableId,nodeId:nodeId,actDefId:actDefId,onClick:onClick,onDbClick:onDbClick}});subTree.loadTree();var a=$("#layout").height()-35;$("#subLayout").height(a);});function onClick(treeId,treeNode){if(typeof(treeId)=="undefined"){return;}if(treeNode.level==0&&treeNode.id!="-1"){$("#subName").text(treeNode.name);$("#tableid").val(treeNode.id);$.ajax({type:"POST",url:__ctx+"/platform/bpm/BpmSubtableRights/get.ht",data:{actdefid:$("#actdefid").val(),nodeid:$("#nodeid").val(),tableid:treeNode.id},success:function(res){var result=eval("("+res+")");var id=typeof(result.permissiontype)!="undefined"?result.id:"0";$("#rightid").val(id);if(typeof(result.permissiontype)!="undefined"){$('input:[name=permissiontype][value="'+result.permissiontype+'"]').attr("checked",true);$("#scriptAuthority").hide();if(result.permissiontype==2){$("#scriptAuthority").show();InitMirror.editor.setCode(result.permissionseting.replaceAll("<br>","\n").replaceAll("<032>",'"'));}}},error:function(res){}});}}function onDbClick(b,a){if(typeof(b)=="undefined"){return;}if(a.level!=0){if($("#subName").text()==a.getParentNode().name){InitMirror.editor.insertCode(a.name);}else{if(a.getParentNode().id=="-1"){InitMirror.editor.insertCode(a.name);}else{$.ligerDialog.warn("选取的子表字段不属于当前操作子表","提示信息");}}}}function changeShow(d,f,g){if(!f.isParent){f=f.getParentNode();}var a=f.showName;var e=__ctx+"/styles/tree/";var h=-1;var b="";if(g=="1"){h=a.lastIndexOf("<img src='"+e+"yes.png'>");b="<img src='"+e+"no.png'>";}else{h=a.lastIndexOf("<img src='"+e+"no.png'>");b="<img src='"+e+"yes.png'>";}if(h!=-1){var c=a.substring(0,h)+b;f.showName=c;d.updateNode(f);}}